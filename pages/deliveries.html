<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <title>Deliveries — EarnRoute</title>
    <link rel="stylesheet" href="../style.css" />
    <script
      defer
      src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"
    ></script>
    <!--Iconify Wev Component-->
    <script src="https://code.iconify.design/iconify-icon/2.1.0/iconify-icon.min.js"></script>
    <!--javascripts-->
    <script defer src="../assets/js/script.js"></script>
    <script type="module" src="../assets/js/config.supabase.js"></script>
    <script type="module" src="../assets/js/auth.supabase.js"></script>
    <script type="module">
      import { logoutUser } from "../assets/js/auth.supabase.js";
      window.__logoutUser = logoutUser;
    </script>

    <script type="module" src="../assets/js/db.supabase.js"></script>
    <script type="module" src="../assets/js/sync.supabase.js"></script>
    <script src="../assets/js/util.dom.js"></script>

    <!-- ✅ Authentication gate -->
    <script type="module">
      import { requireAuthOrRedirect } from "../assets/js/auth.supabase.js";
      requireAuthOrRedirect(); // kicks to login if not signed in
    </script>
  </head>
  <body>
    <!-- Fixed Header -->
    <header class="app-header">
      <button class="hamburger" aria-label="Menu">
        <span class="hamburger-bars"></span>
      </button>
      <div class="title">EarnRoute</div>
    </header>

    <!-- Scrollable Content (kept same overall structure) -->
    <main class="content">
      <h2 style="margin: 0 0 12px 0; margin-bottom: 20px">Deliveries</h2>

      <!-- ACTIVE group -->
      <h2 class="group-title">ACTIVE</h2>
      <div id="checkboxGroupActive" class="checkbox-group"></div>

      <!-- COMPLETED group -->
      <h2 class="group-title" style="margin-top: 18px">COMPLETED</h2>
      <div id="checkboxGroupCompleted" class="checkbox-group"></div>

      <!-- Slide-up: Meal details -->
      <div id="slideUpSheet" class="slide-up hidden">
        <div class="sheet-header">
          <h2 id="mealLabelInSheet"></h2>
          <button id="closeSheetBtn">&times;</button>
        </div>

        <p><strong>Accepted:</strong> <span id="acceptedTimeInSheet"></span></p>
        <p>
          <strong>Delivered:</strong> <span id="deliveredTimeInSheet"></span>
        </p>
        <p><strong>Duration:</strong> <span id="durationInSheet"></span></p>

        <!-- NEW: Courier chooser (must pick one before Delivered) -->
        <div class="courier-chooser">
          <button
            id="btnCourierGH"
            class="courier-btn courier-gh"
            aria-pressed="false"
            type="button"
            title="Grubhub"
          >
            <iconify-icon
              icon="simple-icons:grubhub"
              aria-hidden="true"
            ></iconify-icon>
          </button>
          <!-- Uber Eats -->
          <button
            id="btnCourierUE"
            class="courier-btn courier-ue"
            aria-pressed="false"
            type="button"
            title="Uber Eats"
          >
            <!-- No width/height attributes; CSS controls size -->
            <iconify-icon
              icon="simple-icons:ubereats"
              aria-hidden="true"
            ></iconify-icon>
          </button>
        </div>

        <button class="btn-delivered" id="markDeliveredBtn" disabled>
          Delivered
        </button>
      </div>

      <!-- Toast (re-used by copy message) -->
      <div id="customToast"></div>
    </main>

    <!-- Fixed action bar: + Add / Reset All (above bottom nav) -->
    <div class="action-bar">
      <button id="addMealBtn" class="btn-primary">+ Add</button>
      <button id="resetBtn" class="btn-secondary">Reset All</button>
    </div>

    <!-- Fixed Bottom Navigation -->
    <nav class="bottom-nav">
      <div class="nav-inner">
        <a class="nav-item" href="home.html">
          <i data-lucide="home"></i><span>Home</span>
        </a>
        <a class="nav-item" href="deliveries.html">
          <i data-lucide="utensils"></i><span>Deliveries</span>
        </a>
        <a class="nav-item" href="earnings.html">
          <i data-lucide="dollar-sign"></i><span>Earnings</span>
        </a>
        <a class="nav-item" href="more.html">
          <i data-lucide="more-horizontal"></i><span>More</span>
        </a>
      </div>
    </nav>

    <!-- One global backdrop per page -->
    <div id="modalBackdrop" class="backdrop"></div>

    <!-- Left slide-in drawer (copy from home.html) -->
    <aside id="sideDrawer" class="drawer">
      <div class="drawer-header">
        <h3>George Moreno</h3>
        <button id="closeDrawerBtn" class="drawer-close" aria-label="Close">
          ×
        </button>
      </div>

      <div class="drawer-content">
        <a href="dashboard.html" class="drawer-link">Dashboard</a>
        <a href="home.html" class="drawer-link">Home</a>
        <a href="deliveries.html" class="drawer-link">Deliveries</a>
        <a href="earnings.html" class="drawer-link">Earnings</a>
        <a href="more.html" class="drawer-link">More</a>

        <hr class="drawer-sep" />
        <button id="logoutBtn" class="drawer-logout">Logout</button>
        <p style="text-align: center">Version: 3.0.0</p>
      </div>
    </aside>
  </body>
</html>
